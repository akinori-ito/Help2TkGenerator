<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body { font-family: sans-serif; margin: 20px; background: #f4f4f9; }
      .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
      textarea { width: 100%; height: 150px; margin: 10px 0; font-family: monospace; }
      .input-group { margin-bottom: 15px; }
      input[type="text"] { width: 100%; padding: 8px; box-sizing: border-box; }
      button { background: #4285f4; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
      button:disabled { background: #ccc; }
      #outputContainer { margin-top: 20px; position: relative; }
      #output { background: #272822; color: #f8f8f2; padding: 15px; border-radius: 4px; white-space: pre-wrap; font-family: 'Courier New', monospace; max-height: 400px; overflow-y: auto; }
      .copy-btn { position: absolute; right: 10px; top: 10px; background: #555; font-size: 12px; }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>CLI ➡ Tcl/Tk GUI Generator</h2>
      
      <div class="input-group">
        <label>コマンド名 (例: ffmpeg):</label>
        <input type="text" id="cmdName" placeholder="ffmpeg">
      </div>
      
      <div class="input-group">
        <label>主な利用目的 (LLMへのヒント):</label>
        <input type="text" id="purpose" placeholder="動画をGIFに変換したい、リサイズしたい等">
      </div>
      
      <label>--help メッセージを貼り付け:</label>
      <textarea id="helpText"></textarea>
      
      <button id="genBtn" onclick="generate()">GUIコードを生成</button>
      
      <div id="outputContainer" style="display:none;">
        <button class="copy-btn" onclick="copyCode()">Copy Code</button>
        <div id="output"></div>
      </div>
    </div>

    <script>
      function generate() {
        const btn = document.getElementById('genBtn');
        const outCont = document.getElementById('outputContainer');
        const out = document.getElementById('output');
        
        btn.disabled = true;
        btn.innerText = '生成中... (数秒かかります)';
        
        const cmdName = document.getElementById('cmdName').value;
        const purpose = document.getElementById('purpose').value;
        const helpText = document.getElementById('helpText').value;
        
        google.script.run
          .withSuccessHandler((code) => {
            out.innerText = code;
            outCont.style.display = 'block';
            btn.disabled = false;
            btn.innerText = 'GUIコードを生成';
          })
          .withFailureHandler((err) => {
            alert('エラーが発生しました: ' + err);
            btn.disabled = false;
          })
          .generateTclTk(cmdName, purpose, helpText);
      }

      function copyCode() {
        const text = document.getElementById('output').innerText;
        navigator.clipboard.writeText(text).then(() => alert('コピーしました！'));
      }
    </script>
  </body>
</html>